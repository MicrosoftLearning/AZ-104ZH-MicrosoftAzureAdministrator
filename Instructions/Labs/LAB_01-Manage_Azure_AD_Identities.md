---
lab:
    title: '01 - 管理 Azure Active Directory 标识'
    module: '模块 01 - 标识'
---

# 实验室 01 - 托管 Azure Active Directory 标识

# 学生实验室手册

## 实验室场景

为了允许 Contoso 用户使用 Azure AD 进行身份验证，你被要求预配用户和组帐户。组的成员身份应根据用户职位自动更新。还需要创建包含测试用户帐户的测试 Azure AD 租户，并向该帐户授予 Contoso Azure 订阅中资源的有限访问权限。

## 目标

在本实验室中，你将：

+ 任务 1：创建和配置 Azure AD 用户
+ 任务 2：创建已分配动态成员身份的 Azure AD 组
+ 任务 3：创建 Azure Active Directory (AD) 租户
+ 任务 4： 管理 Azure AD 来宾用户 

## 预计用时：30 分钟

## 说明

### 练习 1

#### 任务 1：创建和配置 Azure AD 用户

在此任务中，我们将创建和配置 Azure AD 用户。

    >**注意**：如果你之前在此 Azure AD 租户上使用过 Azure AD Premium 的试用版许可证，则需要一个新的 Azure AD 租户，或者在该新 Azure AD 租户中在执行任务 3 后执行任务 2。

1. 在 Azure 门户中，搜索并选择 **“Azure Active Directory”**。

1. 在 Azure Active Directory 边栏选项卡上，向下滚动到 **“管理”** 部分，单击 **“用户设置”**，然后查看可用的配置选项。

1. 在 Azure Active Directory 边栏选项卡上的 **“管理”** 部分，单击 **“用户”**，然后单击你的用户帐户以显示其 **“个人资料”** 设置。 

1. 在 **“设置”** 部分单击 **“编辑”**，将 **“使用位置”** 设置为 **“美国”** 并保存更改。

    >**注意**：必须这样做，以便稍后在本实验室中将 Azure AD Premium P2 许可分配给你的用户帐户。

1. 导航回 **“用户 - 所有用户”** 边栏选项卡，然后单击 **“+ 新增用户”**。

1. 使用以下设置创建新用户（将其他设置保留为默认值）：

    | 设置 | 值 |
    | --- | --- |
    | 用户名 | **az104-01a-aaduser1** |
    | 名称 | **az104-01a-aaduser1** |
    | 让我创建密码 | 已启用 |
    | 初始密码 | **Pa55w.rd124** |
    | 使用位置 | **美国** |
    | 职务 | **云管理员** |
    | 部门 | **IT** |

    >**注意**：将完整的 **“用户主体名称”** （用户名加域）**复制到剪贴板**。你将在此任务的稍后部分使用它。

1. 在用户列表中，单击新创建的用户帐户以显示其边栏选项卡。

1. 查看 **“管理”** 部分的可用选项，注意你可以标识分配给该用户帐户的 Azure AD 角色以及该用户帐户对 Azure 资源的权限。

1. 在 **“管理”** 部分，单击 **“已分配的角色”**，然后单击 **“+ 添加分配”** 按钮，并将 **“用户管理员”** 角色分配给 **“az104-01a-aaduser1”**。

    >**注意**：预配新用户时，还可以选择分配 Azure AD 角色。

1. 打开一个 **InPrivate** 浏览器窗口，并使用新创建的用户帐户登录到 [Azure 门户](https://portal.azure.com)。当提示更新密码时，更改该用户的密码。

    >**注意**：可以粘贴剪贴板的内容，而不必键入用户名（包括域名）。

1. 在 **InPrivate** 浏览器窗口中，在 Azure 门户中搜索并选择 **“Azure Active Directory”**。

    >**注意**：尽管此用户帐户可以访问 Azure Active Directory 租户，但它无权访问 Azure 资源。这是预料之中的，因为需要使用 Azure 基于角色的访问控制来明确授予对 Azure 资源的访问权限。 

1. 在 **InPrivate** 浏览器窗口中，在 Azure AD 边栏选项卡上，向下滚动到 **“管理”** 部分，单击 **“用户设置”**，注意你无权修改任何配置选项。

1. 在 **InPrivate** 浏览器窗口中，在 Azure AD 边栏选项卡上的 **“管理”** 部分，单击 **“用户”**，然后单击 **“+ 新增用户”**。

1. 使用以下设置创建新用户（将其他设置保留为默认值）：

    | 设置 | 值 |
    | --- | --- |
    | 用户名 | **az104-01a-aaduser2** |
    | 名称 | **az104-01a-aaduser2** |
    | 让我创建密码 | 已启用 |
    | 初始密码 | **Pa55w.rd124** |
    | 使用位置 | **美国** |
    | 职务 | **系统管理员** |
    | 部门 | **IT** |

1. 以 az104-01a-aaduser1 用户身份从 Azure 门户注销，并关闭 InPrivate 浏览器窗口。

#### 任务 2：创建已分配动态成员身份的 Azure AD 组

在此任务中，你将创建已分配动态成员身份的 Azure Active Directory 组。

1. 返回使用你的用户帐户登录的 Azure 门户，导航回到 Azure AD 租户的 **“概述”** 边栏选项卡，在 **“管理”** 部分单击 **“许可证”**。

    >**注意**：需要 Azure AD Premium P1 或 P2 许可证才能实现动态组。

1. 在 **“管理”** 部分，单击 **“所有产品”**。

1. 单击 **“+ 试用/购买”** 并激活 Azure AD Premium P2 免费试用版。

1. 刷新浏览器窗口，验证是否激活成功。 

1. 在 **“许可证 - 所有产品”** 边栏选项卡上，选择 **“Azure Active Directory Premium P2”** 条目，然后将 Azure AD Premium P2 的所有许可证选项分配给你的用户帐户和两个新创建的用户帐户。

1. 在 Azure 门户中，导航回“Azure AD 租户”边栏选项卡，然后单击 **“组”**。

1. 使用 **“+ 新建组”** 按钮创建一个新组，设置如下：

    | 设置 | 值 |
    | --- | --- |
    | 组类型 | **安全性** |
    | 组名 | **IT 云管理员** |
    | 组说明 | **Contoso IT 云管理员** |
    | 成员身份类型 | **动态用户** |

    >**注意**： 如果 **“成员身份类型”** 下拉列表显示为灰色，请等待几分钟，然后刷新浏览器页面。

1. 单击 **“添加动态查询”**。

1. 在 **“动态成员身份规则”** 边栏选项卡的 **“配置规则”** 选项卡中，使用以下设置创建新规则：

    | 设置 | 值 |
    | --- | --- |
    | 属性 | **jobTitle** |
    | 运算符 | **等于** |
    | 值 | **云管理员** |

1. 保存规则后，返回 **“新建组”** 边栏选项卡，单击 **“创建”**。 

1. 返回 Azure AD 租户的 **“组 - 所有组”** 边栏选项卡，单击 **“+ 新增组”** 按钮，并使用以下设置创建新组：

    | 设置 | 值 |
    | --- | --- |
    | 组类型 | **安全性** |
    | 组名 | **IT 系统管理员** |
    | 组说明 | **Contoso IT 系统管理员** |
    | 成员身份类型 | **动态用户** |

1. 单击 **“添加动态查询”**。

1. 在 **“动态成员身份规则”** 边栏选项卡的 **“配置规则”** 选项卡中，使用以下设置创建新规则：

    | 设置 | 值 |
    | --- | --- |
    | 属性 | **jobTitle** |
    | 运算符 | **等于** |
    | 值 | **系统管理员** |

1. 保存规则后，返回 **“新建组”** 边栏选项卡，单击 **“创建”**。 

1. 返回 Azure AD 租户的 **“组 - 所有组”** 边栏选项卡，单击 **“+ 新增组”** 按钮，并使用以下设置创建新组：

    | 设置 | 值 |
    | --- | --- |
    | 组类型 | **安全性** |
    | 组名 | **IT 实验室管理员** |
    | 组说明 | **Contoso IT 实验室管理员** |
    | 成员身份类型 | **已分配** |

1. 单击 **“未选择成员”**。

1. 在 **“添加成员”** 边栏选项卡中，搜索并选择 **“IT 云管理员”** 和 **“IT 系统管理员”** 组，然后回到 **“新建组”** 边栏选项卡，单击 **“创建”**。

1. 回到 **“组 - 所有组”** 边栏选项卡，单击代表 **“IT 云管理员”** 组的条目，然后显示其 **“成员”** 边栏选项卡。验证 **az104-01a-aaduser1** 出现在组成员列表中。

1. 导航回 **“组 - 所有组”** 边栏选项卡，单击代表 **“IT 系统管理员”** 组的条目，然后显示其 **“成员”** 边栏选项卡。验证 **az104-01a-aaduser2** 出现在组成员列表中。

    >**注意**：动态成员身份组的更新可能会出现延迟。为加速更新，请导航至组边栏选项卡，并显示其 **“动态成员身份规则”** 边栏选项卡，**编辑** **“规则语法”** 文本框中列出的规则（在末尾添加一个空格），然后**保存**更改。

#### 任务 3：创建 Azure Active Directory (AD) 租户

在此任务中，我们将创建新的 Azure AD 租户。

1. 在 Azure 门户中，搜索并选择 **“Azure Active Directory”**。

1. 单击 **“+ 创建租户”** 并指定以下设置：

    | 设置 | 值 |
    | --- | --- |
    | 目录类型 | **Azure Active Directory** |
    | 组织名称 | **Contoso 实验室** |
    | 初始域名 | 由小写字母和数字组成且以字母开头的任何有效 DNS 名称 | 
    | 国家/地区 | **美国** |

   > **注意**： **“初始域名”** 文本框中出现绿色复选标记，表示你键入的域名有效且唯一。

1. 单击 **“查看 + 创建”**，然后单击 **“创建”**。

1. 显示新创建的 Azure AD 租户的边栏选项卡，方法是使用 **“单击此处导航到新目录: Contoso 实验室”** 链接或 Azure 门户工具栏中的 **“目录 + 订阅”** 按钮（正好在 Cloud Shell 按钮的右侧）。

#### 任务 4： 管理 Azure AD 来宾用户。

在此任务中，你将创建 Azure AD 来宾用户，并向其授予 Azure 订阅中资源的访问权限。

1. 在显示“Contoso 实验室”Azure AD 租户的 Azure 门户中，在 **“管理”** 部分，单击 **“用户”**，然后单击 **“+ 新增用户”**。

1. 使用以下设置创建新用户（将其他设置保留为默认值）：

    | 设置 | 值 |
    | --- | --- |
    | 用户名 | **az104-01b-aaduser1** |
    | 名称 | **az104-01b-aaduser1** |
    | 让我创建密码 | 已启用 |
    | 初始密码 | **Pa55w.rd124** |
    | 职务 | **系统管理员** |
    | 部门 | **IT** |

    >**注意**：将完整的 **“用户主体名称”** （用户名加域）**复制到剪贴板**。你将在此任务的稍后部分使用它。

1. 使用 Azure 门户工具栏中的 **“目录 + 订阅”** 按钮（正好在 Cloud Shell 按钮的右侧）切换回默认的 Azure AD 租户。

1. 导航回 **“用户 - 所有用户”** 边栏选项卡，然后单击 **“+ 新增来宾用户”**。

1. 使用以下设置创建新的来宾用户（将其他设置保留为默认值）：

    | 设置 | 值 |
    | --- | --- |
    | 名称 | **az104-01b-aaduser1** |
    | 电子邮件地址 |  与当前租户中的任何用户主体名称都不匹配的任何有效电子邮件地址 |
    | 使用位置 | **美国** |
    | 职务 | **实验室管理员** |
    | 部门 | **IT** |

1. 请单击 **“邀请”**。 

1. 回到 **“用户 - 所有用户”** 边栏选项卡，单击表示新创建的来宾用户帐户的条目。

1. 在 **“az104-01b-aaduser1 - 配置文件”** 边栏选项卡中，单击 **“组”**。

1. 单击 **“+ 添加成员身份”** 并将来宾用户帐户添加到 **“IT 实验室管理员”** 组。


#### 清理资源

   >**注意**：请记得删除任何新创建而不会再使用的 Azure 资源。删除未使用的资源，确保不产生意外成本。在本例中，虽然没有与 Azure Active Directory 租户及其对象相关的额外费用，但你可能需要考虑删除在此实验室中创建的用户帐户、组帐户和 Azure Active Directory 租户。

1. 导航到 **“Azure Active Directory Premium P2 - 许可的用户”** 边栏选项卡，选择分配了许可证的用户帐户，单击 **“删除许可证”**，然后在提示确认时，单击 **“确定”**。

1. 在 Azure 门户中，导航到 **“用户 - 所有用户”** 边栏选项卡，单击代表 **az104-01b-aaduser1** 来宾用户帐户的条目，在 **“az104-01b-aaduser1 - 个人资料”** 边栏选项卡上，单击 **“删除”**，然后在提示确认时，单击 **“确定”**。

1. 重复相同的步骤序列，删除你在本实验室创建的其余用户帐户。

1. 导航到 **“组 - 所有组”** 边栏选项卡，选择你在本实验室中创建的组，单击 **“删除”**，然后在提示确认时，单击 **“确定”**。

1. 在 Azure 门户中，使用 Azure 门户工具栏中的 **“目录 + 订阅”** 按钮（正好在 Cloud Shell 按钮的右侧）来显示“Contoso 实验室”Azure AD 租户的边栏选项卡。

1. 导航回到 **“用户 - 所有用户”** 边栏选项卡，单击代表 **“az104-01b-aaduser1”** 用户帐户的条目，在 **“az104-01b-aaduser1 - 配置文件”** 边栏选项卡上单击 **“删除”**，然后在提示确认时单击 **“确定”**。

1. 导航到“Contoso 实验室”Azure AD 租户的 **“Contoso 实验室 - 概述”** 边栏选项卡，单击 **“删除租户”**，在 **“删除目录‘Contoso 实验室’”** 边栏选项卡上，单击 **“获取删除 Azure 资源的权限”** 链接，在 Azure Active Directory 的 **“属性”** 边栏选项卡上，将 **“Azure 资源的访问管理”** 设置为 **“是”**，然后单击 **“保存”**。

1. 从 Azure 门户注销，然后重新登录。 

1. 导航回 **“删除目录‘Contoso 实验室’”** 边栏选项卡，然后单击 **“删除”**。

#### 回顾

在本实验室中，你已：

- 创建和配置 Azure AD 用户
- 创建已分配动态成员身份的 Azure AD 组
- 创建 Azure Active Directory (AD) 租户
- 管理 Azure AD 来宾用户 
